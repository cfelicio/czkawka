import { Button } from "std-widgets.slint";
import { SelectModel } from "common.slint";
import { Callabler } from "callabler.slint";
import { ColorPalette } from "color_palette.slint";
import { GuiState } from "gui_state.slint";
import { PopupCustomSelect } from "popup_select_custom.slint";
import { Translations } from "translations.slint";

export component PopupSelectResults inherits Rectangle {
    callback show_popup();
    callback close_popup();
    property <[SelectModel]> model: GuiState.select_results_list;
    property <length> item_height: 30px;
    out property <length> item_width;
    out property <length> all_items_height: item_height * (model.length + 2);

    popup_window := PopupWindow {
        width <=> item_width;
        height: all_items_height;

        close-policy: PopupClosePolicy.close-on-click-outside;
        Rectangle {
            width: parent.width;
            height: parent.height;
            border-radius: 5px;
            background: ColorPalette.popup_background;
            VerticalLayout {
                for i in model: Button {
                    text: i.name;
                    height: item_height;
                    clicked => {
                        Callabler.select_items(i.data);
                        popup_window.close();
                    }
                }

                // Custom select
                Button {
                    text: Translations.selection_custom_select_button_text;
                    height: item_height;
                    clicked => {
                        popup_window.close();
                        popup_custom.show_popup(true);
                    }
                }

                // Custom unselect
                Button {
                    text: Translations.selection_custom_unselect_button_text;
                    height: item_height;
                    clicked => {
                        popup_window.close();
                        popup_custom.show_popup(false);
                    }
                }
            }
        }
    }

    // Keep custom popup outside select popup so closing select popup doesn't also close custom popup
    popup_custom := PopupCustomSelect { }

    show_popup() => {
        popup_window.show();
    }
    close_popup() => {
        popup_window.close();
    }
}
